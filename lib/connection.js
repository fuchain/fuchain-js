"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;var _axios = _interopRequireDefault(require("axios"));
var _request = _interopRequireDefault(require("./request"));function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}

const HEADER_BLACKLIST = ["content-type"];

/**
                                            * Base connection
                                            */
class Connection {
  constructor(path, headers = {}) {
    this.path = path;
    this.headers = Object.assign({}, headers);

    Object.keys(headers).forEach(header => {
      if (HEADER_BLACKLIST.includes(header.toLowerCase())) {
        throw new Error(
        `Header ${header} is reserved and cannot be set.`);

      }
    });
  }

  getNodePath() {
    return this.path;
  }

  async pingNode() {
    try {
      _axios.default.get(this.path);
    } catch (err) {
      throw err;
    }
  }

  getApiUrls(endpoint) {
    return (
      this.path +
      {
        blocks: "blocks",
        blocksDetail: "blocks/%(blockHeight)s",
        outputs: "outputs",
        transactions: "transactions",
        transactionsSync: "transactions?mode=sync",
        transactionsAsync: "transactions?mode=async",
        transactionsCommit: "transactions?mode=commit",
        transactionsDetail: "transactions/%(transactionId)s",
        assets: "assets",
        assetsDetail: "transactions?asset_id=",
        metadata: "metadata",
        votes: "votes" }[
      endpoint]);

  }

  _req(path, options = {}) {
    // NOTE: `options.headers` could be undefined, but that's OK.
    options.headers = Object.assign({}, options.headers, this.headers);
    return (0, _request.default)(path, options);
  }

  /**
     * @param blockHeight
     */
  getBlock(blockHeight) {
    return this._req(this.getApiUrls("blocksDetail"), {
      urlTemplateSpec: {
        blockHeight } });


  }

  /**
     * @param assetId
     */
  getAsset(assetId) {
    return this._req(this.getApiUrls("assetsDetail") + assetId);
  }

  /**
     * @param transactionId
     */
  getTransaction(transactionId) {
    return this._req(this.getApiUrls("transactionsDetail"), {
      urlTemplateSpec: {
        transactionId } });


  }

  /**
     * @param transactionId
     * @param status
     */
  listBlocks(transactionId) {
    return this._req(this.getApiUrls("blocks"), {
      query: {
        transaction_id: transactionId } });


  }

  /**
     * @param publicKey
     * @param spent
     */
  listOutputs(publicKey, spent) {
    const query = {
      public_key: publicKey };

    // NOTE: If `spent` is not defined, it must not be included in the
    // query parameters.
    if (spent !== undefined) {
      query.spent = spent.toString();
    }
    return this._req(this.getApiUrls("outputs"), {
      query });

  }

  /**
     * @param assetId
     * @param operation
     */
  listTransactions(assetId, operation) {
    return this._req(this.getApiUrls("transactions"), {
      query: {
        asset_id: assetId,
        operation } });


  }

  /**
     * @param blockId
     */
  listVotes(blockId) {
    return this._req(this.getApiUrls("votes"), {
      query: {
        block_id: blockId } });


  }

  /**
     * @param transaction
     */
  postTransaction(transaction) {
    return this.postTransactionCommit(transaction);
  }

  /**
     * @param transaction
     */
  postTransactionSync(transaction) {
    return this._req(this.getApiUrls("transactionsSync"), {
      method: "POST",
      jsonBody: transaction });

  }

  /**
     * @param transaction
     */
  postTransactionAsync(transaction) {
    return this._req(this.getApiUrls("transactionsAsync"), {
      method: "POST",
      jsonBody: transaction });

  }

  /**
     * @param transaction
     */
  postTransactionCommit(transaction) {
    return this._req(this.getApiUrls("transactionsCommit"), {
      method: "POST",
      jsonBody: transaction });

  }

  /**
     * @param search
     */
  searchAssets(search) {
    return this._req(this.getApiUrls("assets"), {
      query: {
        search } });


  }

  /**
     * @param search
     */
  searchMetadata(search) {
    return this._req(this.getApiUrls("metadata"), {
      query: {
        search } });


  }}exports.default = Connection;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb25uZWN0aW9uLmpzIl0sIm5hbWVzIjpbIkhFQURFUl9CTEFDS0xJU1QiLCJDb25uZWN0aW9uIiwiY29uc3RydWN0b3IiLCJwYXRoIiwiaGVhZGVycyIsIk9iamVjdCIsImFzc2lnbiIsImtleXMiLCJmb3JFYWNoIiwiaGVhZGVyIiwiaW5jbHVkZXMiLCJ0b0xvd2VyQ2FzZSIsIkVycm9yIiwiZ2V0Tm9kZVBhdGgiLCJwaW5nTm9kZSIsImF4aW9zIiwiZ2V0IiwiZXJyIiwiZ2V0QXBpVXJscyIsImVuZHBvaW50IiwiYmxvY2tzIiwiYmxvY2tzRGV0YWlsIiwib3V0cHV0cyIsInRyYW5zYWN0aW9ucyIsInRyYW5zYWN0aW9uc1N5bmMiLCJ0cmFuc2FjdGlvbnNBc3luYyIsInRyYW5zYWN0aW9uc0NvbW1pdCIsInRyYW5zYWN0aW9uc0RldGFpbCIsImFzc2V0cyIsImFzc2V0c0RldGFpbCIsIm1ldGFkYXRhIiwidm90ZXMiLCJfcmVxIiwib3B0aW9ucyIsImdldEJsb2NrIiwiYmxvY2tIZWlnaHQiLCJ1cmxUZW1wbGF0ZVNwZWMiLCJnZXRBc3NldCIsImFzc2V0SWQiLCJnZXRUcmFuc2FjdGlvbiIsInRyYW5zYWN0aW9uSWQiLCJsaXN0QmxvY2tzIiwicXVlcnkiLCJ0cmFuc2FjdGlvbl9pZCIsImxpc3RPdXRwdXRzIiwicHVibGljS2V5Iiwic3BlbnQiLCJwdWJsaWNfa2V5IiwidW5kZWZpbmVkIiwidG9TdHJpbmciLCJsaXN0VHJhbnNhY3Rpb25zIiwib3BlcmF0aW9uIiwiYXNzZXRfaWQiLCJsaXN0Vm90ZXMiLCJibG9ja0lkIiwiYmxvY2tfaWQiLCJwb3N0VHJhbnNhY3Rpb24iLCJ0cmFuc2FjdGlvbiIsInBvc3RUcmFuc2FjdGlvbkNvbW1pdCIsInBvc3RUcmFuc2FjdGlvblN5bmMiLCJtZXRob2QiLCJqc29uQm9keSIsInBvc3RUcmFuc2FjdGlvbkFzeW5jIiwic2VhcmNoQXNzZXRzIiwic2VhcmNoIiwic2VhcmNoTWV0YWRhdGEiXSwi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LEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXhpb3MgZnJvbSBcImF4aW9zXCI7XG5pbXBvcnQgcmVxdWVzdCBmcm9tIFwiLi9yZXF1ZXN0XCI7XG5cbmNvbnN0IEhFQURFUl9CTEFDS0xJU1QgPSBbXCJjb250ZW50LXR5cGVcIl07XG5cbi8qKlxuICogQmFzZSBjb25uZWN0aW9uXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbm5lY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKHBhdGgsIGhlYWRlcnMgPSB7fSkge1xuICAgICAgICB0aGlzLnBhdGggPSBwYXRoO1xuICAgICAgICB0aGlzLmhlYWRlcnMgPSBPYmplY3QuYXNzaWduKHt9LCBoZWFkZXJzKTtcblxuICAgICAgICBPYmplY3Qua2V5cyhoZWFkZXJzKS5mb3JFYWNoKGhlYWRlciA9PiB7XG4gICAgICAgICAgICBpZiAoSEVBREVSX0JMQUNLTElTVC5pbmNsdWRlcyhoZWFkZXIudG9Mb3dlckNhc2UoKSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgIGBIZWFkZXIgJHtoZWFkZXJ9IGlzIHJlc2VydmVkIGFuZCBjYW5ub3QgYmUgc2V0LmBcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXROb2RlUGF0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGF0aDtcbiAgICB9XG5cbiAgICBhc3luYyBwaW5nTm9kZSgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF4aW9zLmdldCh0aGlzLnBhdGgpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldEFwaVVybHMoZW5kcG9pbnQpIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIHRoaXMucGF0aCArXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYmxvY2tzOiBcImJsb2Nrc1wiLFxuICAgICAgICAgICAgICAgIGJsb2Nrc0RldGFpbDogXCJibG9ja3MvJShibG9ja0hlaWdodClzXCIsXG4gICAgICAgICAgICAgICAgb3V0cHV0czogXCJvdXRwdXRzXCIsXG4gICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25zOiBcInRyYW5zYWN0aW9uc1wiLFxuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uc1N5bmM6IFwidHJhbnNhY3Rpb25zP21vZGU9c3luY1wiLFxuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uc0FzeW5jOiBcInRyYW5zYWN0aW9ucz9tb2RlPWFzeW5jXCIsXG4gICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25zQ29tbWl0OiBcInRyYW5zYWN0aW9ucz9tb2RlPWNvbW1pdFwiLFxuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uc0RldGFpbDogXCJ0cmFuc2FjdGlvbnMvJSh0cmFuc2FjdGlvbklkKXNcIixcbiAgICAgICAgICAgICAgICBhc3NldHM6IFwiYXNzZXRzXCIsXG4gICAgICAgICAgICAgICAgYXNzZXRzRGV0YWlsOiBcInRyYW5zYWN0aW9ucz9hc3NldF9pZD1cIixcbiAgICAgICAgICAgICAgICBtZXRhZGF0YTogXCJtZXRhZGF0YVwiLFxuICAgICAgICAgICAgICAgIHZvdGVzOiBcInZvdGVzXCJcbiAgICAgICAgICAgIH1bZW5kcG9pbnRdXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgX3JlcShwYXRoLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgLy8gTk9URTogYG9wdGlvbnMuaGVhZGVyc2AgY291bGQgYmUgdW5kZWZpbmVkLCBidXQgdGhhdCdzIE9LLlxuICAgICAgICBvcHRpb25zLmhlYWRlcnMgPSBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zLmhlYWRlcnMsIHRoaXMuaGVhZGVycyk7XG4gICAgICAgIHJldHVybiByZXF1ZXN0KHBhdGgsIG9wdGlvbnMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSBibG9ja0hlaWdodFxuICAgICAqL1xuICAgIGdldEJsb2NrKGJsb2NrSGVpZ2h0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZXEodGhpcy5nZXRBcGlVcmxzKFwiYmxvY2tzRGV0YWlsXCIpLCB7XG4gICAgICAgICAgICB1cmxUZW1wbGF0ZVNwZWM6IHtcbiAgICAgICAgICAgICAgICBibG9ja0hlaWdodFxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gYXNzZXRJZFxuICAgICAqL1xuICAgIGdldEFzc2V0KGFzc2V0SWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlcSh0aGlzLmdldEFwaVVybHMoXCJhc3NldHNEZXRhaWxcIikgKyBhc3NldElkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gdHJhbnNhY3Rpb25JZFxuICAgICAqL1xuICAgIGdldFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlcSh0aGlzLmdldEFwaVVybHMoXCJ0cmFuc2FjdGlvbnNEZXRhaWxcIiksIHtcbiAgICAgICAgICAgIHVybFRlbXBsYXRlU3BlYzoge1xuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uSWRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHRyYW5zYWN0aW9uSWRcbiAgICAgKiBAcGFyYW0gc3RhdHVzXG4gICAgICovXG4gICAgbGlzdEJsb2Nrcyh0cmFuc2FjdGlvbklkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZXEodGhpcy5nZXRBcGlVcmxzKFwiYmxvY2tzXCIpLCB7XG4gICAgICAgICAgICBxdWVyeToge1xuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uX2lkOiB0cmFuc2FjdGlvbklkXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSBwdWJsaWNLZXlcbiAgICAgKiBAcGFyYW0gc3BlbnRcbiAgICAgKi9cbiAgICBsaXN0T3V0cHV0cyhwdWJsaWNLZXksIHNwZW50KSB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0ge1xuICAgICAgICAgICAgcHVibGljX2tleTogcHVibGljS2V5XG4gICAgICAgIH07XG4gICAgICAgIC8vIE5PVEU6IElmIGBzcGVudGAgaXMgbm90IGRlZmluZWQsIGl0IG11c3Qgbm90IGJlIGluY2x1ZGVkIGluIHRoZVxuICAgICAgICAvLyBxdWVyeSBwYXJhbWV0ZXJzLlxuICAgICAgICBpZiAoc3BlbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcXVlcnkuc3BlbnQgPSBzcGVudC50b1N0cmluZygpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9yZXEodGhpcy5nZXRBcGlVcmxzKFwib3V0cHV0c1wiKSwge1xuICAgICAgICAgICAgcXVlcnlcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIGFzc2V0SWRcbiAgICAgKiBAcGFyYW0gb3BlcmF0aW9uXG4gICAgICovXG4gICAgbGlzdFRyYW5zYWN0aW9ucyhhc3NldElkLCBvcGVyYXRpb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlcSh0aGlzLmdldEFwaVVybHMoXCJ0cmFuc2FjdGlvbnNcIiksIHtcbiAgICAgICAgICAgIHF1ZXJ5OiB7XG4gICAgICAgICAgICAgICAgYXNzZXRfaWQ6IGFzc2V0SWQsXG4gICAgICAgICAgICAgICAgb3BlcmF0aW9uXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSBibG9ja0lkXG4gICAgICovXG4gICAgbGlzdFZvdGVzKGJsb2NrSWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlcSh0aGlzLmdldEFwaVVybHMoXCJ2b3Rlc1wiKSwge1xuICAgICAgICAgICAgcXVlcnk6IHtcbiAgICAgICAgICAgICAgICBibG9ja19pZDogYmxvY2tJZFxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gdHJhbnNhY3Rpb25cbiAgICAgKi9cbiAgICBwb3N0VHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zdFRyYW5zYWN0aW9uQ29tbWl0KHRyYW5zYWN0aW9uKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gdHJhbnNhY3Rpb25cbiAgICAgKi9cbiAgICBwb3N0VHJhbnNhY3Rpb25TeW5jKHRyYW5zYWN0aW9uKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZXEodGhpcy5nZXRBcGlVcmxzKFwidHJhbnNhY3Rpb25zU3luY1wiKSwge1xuICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgIGpzb25Cb2R5OiB0cmFuc2FjdGlvblxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gdHJhbnNhY3Rpb25cbiAgICAgKi9cbiAgICBwb3N0VHJhbnNhY3Rpb25Bc3luYyh0cmFuc2FjdGlvbikge1xuICAgICAgICByZXR1cm4gdGhpcy5fcmVxKHRoaXMuZ2V0QXBpVXJscyhcInRyYW5zYWN0aW9uc0FzeW5jXCIpLCB7XG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAganNvbkJvZHk6IHRyYW5zYWN0aW9uXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB0cmFuc2FjdGlvblxuICAgICAqL1xuICAgIHBvc3RUcmFuc2FjdGlvbkNvbW1pdCh0cmFuc2FjdGlvbikge1xuICAgICAgICByZXR1cm4gdGhpcy5fcmVxKHRoaXMuZ2V0QXBpVXJscyhcInRyYW5zYWN0aW9uc0NvbW1pdFwiKSwge1xuICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgIGpzb25Cb2R5OiB0cmFuc2FjdGlvblxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gc2VhcmNoXG4gICAgICovXG4gICAgc2VhcmNoQXNzZXRzKHNlYXJjaCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcmVxKHRoaXMuZ2V0QXBpVXJscyhcImFzc2V0c1wiKSwge1xuICAgICAgICAgICAgcXVlcnk6IHtcbiAgICAgICAgICAgICAgICBzZWFyY2hcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHNlYXJjaFxuICAgICAqL1xuICAgIHNlYXJjaE1ldGFkYXRhKHNlYXJjaCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcmVxKHRoaXMuZ2V0QXBpVXJscyhcIm1ldGFkYXRhXCIpLCB7XG4gICAgICAgICAgICBxdWVyeToge1xuICAgICAgICAgICAgICAgIHNlYXJjaFxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG4iXX0=